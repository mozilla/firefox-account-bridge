dependencies:
  override:
    - sudo apt-get install expect
    - ulimit -S -n 2048;
    - mkdir -p $HOME/.vnc
    - bash tests/ci/setvncpass.sh
    - rm -rf node_modules
    - cp server/config/local.json-dist server/config/local.json
    - npm i --production
    - node_modules/.bin/grunt build
    - nohup bash -c "CONFIG_FILES=server/config/local.json,server/config/production.json,tests/ci/config_circleci.json node_modules/.bin/grunt serverproc:dist &"
    - sudo apt-get install tightvncserver
    - npm install intern@3.0.0 bower zaach/node-XMLHttpRequest.git#onerror firefox-profile@0.3.3 request@2.40.0 sync-exec@0.5.0 convict@0.8.0
    - wget http://selenium-release.storage.googleapis.com/2.53/selenium-server-standalone-2.53.0.jar
    - DISPLAY=:1 nohup bash -c "java -jar selenium-server-standalone-2.53.0.jar &"
    - tightvncserver :1
    - curl 127.0.0.1:3030
    - firefox --version

test:
  override:
    - ps aux | grep vnc
    - node_modules/.bin/intern-runner config=tests/intern_functional_circle fxaAuthRoot=http://fxadeploybox.dev.lcip.org:9000 fxaEmailRoot=http://fxadeploybox.dev.lcip.org:9001 fxaOauthApp=http://fxadeploybox.dev.lcip.org:8080 fxaUntrustedOauthApp=http://fxadeploybox.dev.lcip.org:10139 fxaProduction=true
